<% subcategories.forEach(subcategory => { %>
  <div class="border-l-2 border-white/10 pl-4 ml-2 mt-2">
    <!-- Subcategoría -->
    <div class="flex items-center justify-between py-2 hover:bg-white/5 rounded-lg px-2 transition-colors group">
      <div class="flex items-center space-x-2">
        <% if (subcategory.icon_type === 'png' && subcategory.icon) { %>
          <img src="<%= subcategory.icon %>" alt="<%= subcategory.display_name %>" class="w-5 h-5">
        <% } else { %>
          <i class="<%= subcategory.icon.includes(' ') ? subcategory.icon : 'fas ' + subcategory.icon %> text-blue-400"></i>
        <% } %>
        <span class="font-medium text-gray-200"><%= subcategory.display_name %></span>
        <span class="text-xs text-gray-500">(Orden: <%= subcategory.order_index %>)</span>
        <% if (subcategory.is_hidden) { %>
          <span class="text-xs px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded"><i class="fas fa-eye-slash mr-1"></i>Oculto</span>
        <% } %>
      </div>
      <div class="flex space-x-1">
        <button onclick="showSubcategoryModal(<%= subcategory.category_id %>, '<%= subcategory.display_name.replace(/'/g, "\\'") %>', <%= subcategory.id %>)" class="glass px-2 py-1 rounded text-xs hover:bg-green-500/20 text-green-400 transition-all" title="Agregar sub-subcategoría">
          <i class="fas fa-sitemap"></i>
        </button>
        <a href="/admin/docs/new?subcategory=<%= subcategory.id %>" class="glass px-2 py-1 rounded text-xs hover:bg-green-500/20 text-green-400 transition-all" title="Nuevo documento">
          <i class="fas fa-plus"></i>
        </a>
        <button onclick="editSubcategory(<%= subcategory.id %>, '<%= subcategory.name.replace(/'/g, "\\'") %>', '<%= subcategory.display_name.replace(/'/g, "\\'") %>', '<%= subcategory.slug %>', '<%= subcategory.icon %>', <%= subcategory.order_index %>, <%= subcategory.category_id %>, <%= subcategory.is_hidden ? 1 : 0 %>, '<%= subcategory.icon_type || 'fontawesome' %>', <%= subcategory.parent_subcategory_id || 'null' %>)" class="glass px-2 py-1 rounded text-xs hover:bg-blue-500/20 text-blue-400 transition-all" title="Editar subcategoría">
          <i class="fas fa-edit"></i>
        </button>
        <button onclick="deleteSubcategory(<%= subcategory.id %>, '<%= subcategory.display_name.replace(/'/g, "\\'") %>')" class="glass px-2 py-1 rounded text-xs hover:bg-red-500/20 text-red-400 transition-all" title="Eliminar subcategoría">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>

    <!-- Documentos de esta subcategoría -->
    <% if (subcategory.docs && subcategory.docs.length > 0) { %>
      <div class="ml-4 mt-1 space-y-1">
        <% subcategory.docs.forEach(doc => { %>
          <div class="flex items-center justify-between py-2 px-2 hover:bg-white/5 rounded-lg transition-colors group">
            <div class="flex items-center space-x-2 flex-1">
              <i class="fas fa-file-alt text-purple-400 text-sm"></i>
              <div class="flex-1">
                <div class="text-sm text-white font-medium"><%= doc.title %></div>
                <div class="text-xs text-gray-500"><%= doc.slug %></div>
              </div>
              <span class="text-xs text-gray-500">Orden: <%= doc.order_index %></span>
            </div>
            <div class="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
              <a href="/admin/docs/edit/<%= doc.id %>" class="glass px-2 py-1 rounded text-xs hover:bg-blue-500/20 text-blue-400 transition-all" title="Editar">
                <i class="fas fa-edit"></i>
              </a>
              <form method="POST" action="/admin/docs/delete/<%= doc.id %>" class="inline" onsubmit="event.preventDefault(); showConfirmModal('¿Eliminar <%= doc.title.replace(/'/g, "\\'") %>?', () => this.submit(), 'danger')">
                <button type="submit" class="glass px-2 py-1 rounded text-xs hover:bg-red-500/20 text-red-400 transition-all" title="Eliminar">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </div>
          </div>
        <% }); %>
      </div>
    <% } %>

    <!-- Subcategorías anidadas -->
    <% if (subcategory.subcategories && subcategory.subcategories.length > 0) { %>
      <%- include('./admin-doc-tree', { subcategories: subcategory.subcategories }) %>
    <% } %>
  </div>
<% }); %>
