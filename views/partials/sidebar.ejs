<!-- Sidebar con categorías -->
<aside id="sidebar" class="fixed left-0 top-14 sm:top-20 bottom-0 w-64 sm:w-80 glass-dark border-r border-white/10 overflow-y-auto scrollbar-thin -translate-x-full lg:translate-x-0 transition-transform duration-300 z-40">
  <nav class="p-3 sm:p-6">
    <!-- Mini buscador del sidebar -->
    <div class="mb-4">
      <div class="relative">
        <input 
          type="text" 
          id="sidebar-search"
          placeholder="Buscar en documentos..."
          class="w-full glass px-4 py-2 pl-10 rounded-lg text-white text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
        >
        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"></i>
        <button 
          id="clear-sidebar-search" 
          class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-all hidden"
          onclick="clearSidebarSearch()"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <% if (isAuthenticated) { %>
      <div class="mb-4">
        <button onclick="showCategoryModal()" class="w-full glass px-3 py-2 rounded-lg hover:bg-green-500/20 text-green-400 transition-all text-sm font-medium">
          <i class="fas fa-plus mr-2"></i>Nueva Categoría
        </button>
      </div>
    <% } %>
    
    <% if (structure && structure.length > 0) { %>
      <% structure.forEach((category, catIndex) => { %>
        <div class="mb-6 animate-slide-in" style="animation-delay: <%= catIndex * 0.1 %>s" data-category-id="<%= category.id %>">
          <div class="flex items-center justify-between mb-3 group relative">
            <button onclick="toggleCategory(<%= category.id %>)" class="flex items-center flex-1 text-left font-display">
              <i class="fas fa-chevron-down mr-2 text-sm transition-transform category-chevron-<%= category.id %>" id="chevron-<%= category.id %>"></i>
              <% if (category.icon_type === 'image') { %>
                <img src="<%= category.icon %>" alt="" class="w-5 h-5 mr-2 object-contain" onerror="this.style.display='none'">
              <% } else { %>
                <i class="<%= category.icon.includes(' ') ? category.icon : 'fas ' + category.icon %> mr-2"></i>
              <% } %>
              <h3 class="text-lg font-semibold text-white">
                <%= category.display_name %>
              </h3>
            </button>
            <% if (isAuthenticated) { %>
              <div class="flex flex-row items-center gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200">
                <button onclick="showSubcategoryModal(<%= category.id %>, '<%= category.display_name %>')" class="glass px-2 py-1 rounded hover:bg-green-500/20 text-green-400 text-xs transition-all" title="Nueva Subcategoría">
                  <i class="fas fa-plus"></i>
                </button>
                <button onclick="editCategoryModal(<%= category.id %>, '<%= category.name %>', '<%= category.display_name %>', '<%= category.slug %>', '<%= category.icon %>', <%= category.order_index %>, <%= category.is_hidden ? 1 : 0 %>, '<%= category.icon_type || 'fontawesome' %>')" class="glass px-2 py-1 rounded hover:bg-blue-500/20 text-blue-400 text-xs transition-all" title="Editar">
                  <i class="fas fa-edit"></i>
                </button>
                <button onclick="deleteCategory(<%= category.id %>, '<%= category.display_name %>')" class="glass px-2 py-1 rounded hover:bg-red-500/20 text-red-400 text-xs transition-all" title="Eliminar">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            <% } %>
          </div>
          
          <div id="category-content-<%= category.id %>" class="category-content">
            <%- include('subcategory-tree', { subcategories: category.subcategories, category: category, isAuthenticated: isAuthenticated }) %>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <p class="text-gray-400 text-sm">No hay guías disponibles</p>
    <% } %>
  </nav>
</aside>
